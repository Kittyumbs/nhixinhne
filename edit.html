<!DOCTYPE html>
<html class="light" lang="vi"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Qu·∫£n L√Ω Trang Bio</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<!-- Google API Client -->
<script src="https://apis.google.com/js/api.js"></script>
<!-- Firebase SDK -->
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBk0GLruKL0GiU_ZZcL8p5O6PtswWapEHE",
    authDomain: "nhixinhne-a39e2.firebaseapp.com",
    projectId: "nhixinhne-a39e2",
    storageBucket: "nhixinhne-a39e2.firebasestorage.app",
    messagingSenderId: "677175421970",
    appId: "1:677175421970:web:9aa74f064d02f49537fccb",
    measurementId: "G-H363JEFJ8P"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);

  // Initialize Firestore
  const db = getFirestore(app);

  // Make db available globally
  window.db = db;
  window.doc = doc;
  window.getDoc = getDoc;
  window.setDoc = setDoc;
</script>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ee2b6c",
                        "background-light": "#f8f6f6",
                        "background-dark": "#221016",
                    },
                    fontFamily: {
                        "display": ["Plus Jakarta Sans", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "1rem", // 16px
                        "lg": "1.5rem",    // 24px - Modified for better mobile inputs
                        "xl": "3rem",      // 48px - Very round
                        "full": "9999px"
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(238, 43, 108, 0.1)',
                        'card': '0 2px 10px rgba(0, 0, 0, 0.03)',
                    }
                },
            },
        }
    </script>
<style>.no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
<style>
    body {
      min-height: max(884px, 100dvh);
    }
  </style>
  </head>
<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-100 antialiased min-h-screen pb-24">
<div class="sticky top-0 z-50 bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-md border-b border-gray-100 dark:border-gray-800">
<div class="max-w-md mx-auto px-4 h-16 flex items-center justify-between">
<div class="flex items-center gap-3">
<button class="material-symbols-outlined text-gray-600 dark:text-gray-300">arrow_back_ios_new</button>
<h1 class="text-xl font-bold tracking-tight">Qu·∫£n L√Ω Bio</h1>
</div>
<div class="flex items-center gap-3">
<button class="material-symbols-outlined text-gray-500 hover:text-primary transition-colors" title="Xem th·ª≠">visibility</button>
<button id="publishBtn" class="bg-primary hover:bg-primary/90 text-white px-5 py-2 rounded-full text-sm font-bold shadow-soft transition-all transform active:scale-95">
                    Xu·∫•t b·∫£n
                </button>
</div>
</div>
</div>
<div class="max-w-md mx-auto px-4 pt-6 flex flex-col gap-8">
<section class="flex flex-col items-center gap-6">
<div class="relative group cursor-pointer">
<div class="w-28 h-28 rounded-full border-4 border-white dark:border-gray-800 shadow-lg overflow-hidden bg-gray-200">
<img id="avatarPreview" alt="Avatar" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuD4-4nseipxqo0kUCZE9uFM44MdTSYdXZK7Ip6KdlyymxoMUAFfS7Ve06-Q9hHGxjPluC6X1APdZdN4rucbf81eaxjkm_YhmgvFAXw4pcASA-ix8llEXZC5nUN6SacEV2XF_k-dtb9Yva94yHVEtkau6hvENT-rlCm-EdLda-wSIKp47tOJkZDAYu-1VrHNM-2ra5qRFgsaqhl86noxOuc2f75yKQwk7z-_QUC1XkJ0rEhR3XHAN6BLxLkkhAlcI2nDPjqbfeDSZ3h2"/>
</div>
<div class="absolute bottom-0 right-0 bg-primary text-white w-9 h-9 rounded-full flex items-center justify-center shadow-md border-2 border-background-light dark:border-background-dark cursor-pointer" onclick="document.getElementById('avatarInput').click()">
<span class="material-symbols-outlined text-lg">photo_camera</span>
</div>
<input type="file" id="avatarInput" accept="image/*" class="hidden" onchange="handleAvatarUpload(event)">
</div>
<div class="w-full space-y-4">
<div class="space-y-1.5">
<label class="text-sm font-bold text-gray-700 dark:text-gray-300 ml-1">T√™n hi·ªÉn th·ªã</label>
<input class="w-full h-12 px-4 rounded-lg bg-white dark:bg-gray-800 border-transparent focus:border-primary focus:ring-0 text-gray-900 dark:text-white font-medium shadow-card placeholder-gray-400" type="text" value="M·∫π B·ªâm S·ªØa Review"/>
</div>
<div class="space-y-1.5">
<label class="text-sm font-bold text-gray-700 dark:text-gray-300 ml-1">Gi·ªõi thi·ªáu (Bio)</label>
<textarea class="w-full h-24 p-4 rounded-lg bg-white dark:bg-gray-800 border-transparent focus:border-primary focus:ring-0 text-gray-900 dark:text-white text-sm shadow-card resize-none placeholder-gray-400 leading-relaxed">Chia s·∫ª kinh nghi·ªám nu√¥i d·∫°y con & sƒÉn deal hot cho b√© y√™u üçº Follow ƒë·ªÉ nh·∫≠n voucher m·ªói ng√†y nh√©!</textarea>
</div>
</div>
</section>
<section class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-card border border-gray-50 dark:border-gray-700">
<div class="flex items-center justify-between mb-4">
<h2 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
<span class="material-symbols-outlined text-primary">image</span>
                    H√¨nh n·ªÅn
                </h2>
</div>
<div class="space-y-4">
<div class="relative group cursor-pointer" onclick="document.getElementById('backgroundInput').click()">
<div id="backgroundPreview" class="w-full h-32 bg-gradient-to-br from-pink-100 to-purple-100 dark:from-gray-700 dark:to-gray-600 rounded-lg border-2 border-dashed border-gray-300 dark:border-gray-500 flex items-center justify-center transition-all group-hover:border-primary">
<div class="text-center">
<span class="material-symbols-outlined text-3xl text-gray-400 group-hover:text-primary transition-colors">add_photo_alternate</span>
<p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Nh·∫•n ƒë·ªÉ thay ƒë·ªïi h√¨nh n·ªÅn</p>
</div>
</div>
<div class="absolute top-2 right-2 bg-white dark:bg-gray-800 rounded-full p-1.5 shadow-md opacity-0 group-hover:opacity-100 transition-opacity">
<span class="material-symbols-outlined text-lg text-gray-600 dark:text-gray-300">edit</span>
</div>
</div>
<input type="file" id="backgroundInput" accept="image/*" class="hidden" onchange="handleBackgroundUpload(event)">
<div class="flex items-center gap-3 p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg">
<div class="w-8 h-8 rounded bg-primary/10 flex items-center justify-center">
<span class="material-symbols-outlined text-sm text-primary">info</span>
</div>
<p class="text-xs text-gray-600 dark:text-gray-300">H√¨nh n·ªÅn s·∫Ω hi·ªÉn th·ªã ·ªü ph·∫ßn ƒë·∫ßu trang. K√≠ch th∆∞·ªõc ƒë·ªÅ ngh·ªã: 1200x400px</p>
</div>
</input>
</section>
<section class="bg-white dark:bg-gray-800 rounded-2xl p-5 shadow-card border border-gray-50 dark:border-gray-700">
<div class="flex items-center justify-between mb-4">
<h2 class="text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2">
<span class="material-symbols-outlined text-primary">category</span>
                    Danh m·ª•c
                </h2>
<button id="addCategoryBtn" class="text-primary text-sm font-bold flex items-center gap-1 hover:bg-primary/5 px-2 py-1.5 rounded-lg transition-colors">
<span class="material-symbols-outlined text-lg">add</span> Th√™m m·ªõi
                </button>
</div>
<div class="flex gap-2 overflow-x-auto no-scrollbar pb-4 snap-x" id="categoriesList">
<!-- Categories will be dynamically added here -->
</div>
<div id="categoryEditor" class="pt-4 border-t border-dashed border-gray-200 dark:border-gray-700 space-y-5 hidden">
<div class="space-y-2">
<div class="flex justify-between items-center">
<label class="text-xs font-bold text-gray-500 uppercase tracking-wider">Ch·ªçn Icon</label>
<button class="text-xs text-primary font-bold">Xem t·∫•t c·∫£</button>
</div>
<div class="flex gap-3 overflow-x-auto no-scrollbar py-1" id="iconSelector">
<!-- Icon options will be dynamically added here -->
</div>
</div>
<div class="grid gap-4">
<div class="space-y-1.5">
<label class="text-xs font-bold text-gray-500 uppercase tracking-wider">T√™n danh m·ª•c</label>
<input id="categoryName" class="w-full h-11 px-3 rounded-lg bg-gray-50 dark:bg-gray-900 border-transparent focus:border-primary focus:ring-0 text-sm font-bold text-gray-900 dark:text-white transition-all placeholder-gray-400" type="text" placeholder="Nh·∫≠p t√™n danh m·ª•c..."/>
</div>
<div class="space-y-1.5">
<label class="text-xs font-bold text-gray-500 uppercase tracking-wider">M√¥ t·∫£ (T√πy ch·ªçn)</label>
<input id="categoryDesc" class="w-full h-11 px-3 rounded-lg bg-gray-50 dark:bg-gray-900 border-transparent focus:border-primary focus:ring-0 text-sm font-medium text-gray-900 dark:text-white transition-all placeholder-gray-400" placeholder="Nh·∫≠p m√¥ t·∫£ ng·∫Øn cho danh m·ª•c..." type="text"/>
</div>
</div>
<div class="flex items-center justify-between gap-3 pt-2">
<button id="deleteCategoryBtn" class="text-gray-400 hover:text-red-500 flex items-center gap-1 pl-1 pr-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors text-xs font-bold hidden" title="X√≥a danh m·ª•c">
<span class="material-symbols-outlined text-lg">delete</span> X√≥a
                    </button>
<div class="flex gap-2">
<button id="cancelCategoryBtn" class="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-4 py-2 rounded-lg text-sm font-bold hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
H·ªßy
</button>
<button id="saveCategoryBtn" class="bg-gray-900 dark:bg-white text-white dark:text-gray-900 px-6 py-2 rounded-lg text-sm font-bold shadow-md hover:opacity-90 transition-opacity">
L∆∞u danh m·ª•c
</button>
</div>
</div>
</div>
</section>
<div class="space-y-4" id="productsSection">
<h2 class="text-lg font-bold text-gray-900 dark:text-white px-1" id="productsTitle">Ch·ªçn danh m·ª•c ƒë·ªÉ xem s·∫£n ph·∫©m</h2>
<div id="productsList">
<!-- Products will be dynamically added here -->
</div>
</div>
<div class="h-24"></div>
</div>
<div class="fixed bottom-0 left-0 w-full p-4 bg-gradient-to-t from-background-light via-background-light to-transparent dark:from-background-dark dark:via-background-dark pointer-events-none flex justify-center z-40">
<button class="pointer-events-auto bg-gray-900 dark:bg-white text-white dark:text-gray-900 h-14 w-full max-w-sm rounded-lg flex items-center justify-center gap-3 font-bold shadow-xl hover:scale-[1.02] transition-transform active:scale-95">
<span class="material-symbols-outlined">add</span>
            Th√™m s·∫£n ph·∫©m m·ªõi
        </button>
</div>

<script>
// Data structures
let categories = [];

let selectedCategoryId = null;
let editingCategoryId = null;
let availableIcons = ['child_care', 'toys', 'restaurant', 'checkroom', 'stroller', 'crib', 'medical_services', 'smart_toy', 'celebration', 'sports_soccer'];

document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});

async function initializeApp() {
    try {
        // Initialize Google API first
        await initGoogleAPI();
        console.log('App initialized successfully');
    } catch (error) {
        console.warn('Google API initialization failed, continuing without upload functionality:', error);
    }

    // Initialize app functionality regardless of Google API status
    loadCategories();
    setupEventListeners();
    renderIconSelector();
}

function setupEventListeners() {
    // Category management
    document.getElementById('addCategoryBtn').addEventListener('click', () => showCategoryEditor());
    document.getElementById('cancelCategoryBtn').addEventListener('click', () => hideCategoryEditor());
    document.getElementById('saveCategoryBtn').addEventListener('click', () => saveCategory());
    document.getElementById('deleteCategoryBtn').addEventListener('click', () => deleteCategory());

    // Product management
    document.querySelector('.fixed button').addEventListener('click', () => addNewProduct());

    // Publish/Save functionality
    document.getElementById('publishBtn').addEventListener('click', () => saveToFirebase());
}

function loadCategories() {
    const categoriesList = document.getElementById('categoriesList');
    categoriesList.innerHTML = '';

    categories.forEach(category => {
        const categoryBtn = createCategoryButton(category);
        categoriesList.appendChild(categoryBtn);
    });
}

function createCategoryButton(category) {
    const button = document.createElement('button');
    button.className = `flex-shrink-0 snap-start ${selectedCategoryId === category.id ? 'bg-primary text-white' : 'bg-gray-50 dark:bg-gray-700 text-gray-600 dark:text-gray-300'} pl-3 pr-4 py-2 rounded-lg font-semibold text-sm border border-transparent hover:bg-gray-100 dark:hover:bg-gray-600 flex items-center gap-2 transition-colors`;
    button.innerHTML = `
        <span class="material-symbols-outlined text-lg">${category.icon}</span>
        ${category.name}
    `;
    button.addEventListener('click', () => selectCategory(category.id));
    return button;
}

function selectCategory(categoryId) {
    selectedCategoryId = categoryId;
    loadCategories();
    showCategoryProducts(categoryId);
}

function showCategoryProducts(categoryId) {
    const category = categories.find(c => c.id === categoryId);
    const productsTitle = document.getElementById('productsTitle');
    const productsList = document.getElementById('productsList');

    productsTitle.textContent = `S·∫£n ph·∫©m - ${category.name} (${category.products.length})`;
    productsList.innerHTML = '';

    if (category.products.length === 0) {
        productsList.innerHTML = `
            <div class="text-center py-8 text-gray-500">
                <span class="material-symbols-outlined text-4xl mb-2 block">inventory_2</span>
                Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong danh m·ª•c n√†y
            </div>
        `;
        return;
    }

    category.products.forEach(product => {
        const productCard = createProductCard(product, categoryId);
        productsList.appendChild(productCard);
    });
}

function createProductCard(product, categoryId) {
    const card = document.createElement('div');
    card.className = 'bg-white dark:bg-gray-800 p-4 rounded-DEFAULT shadow-card flex gap-4 group';
    card.innerHTML = `
        <div class="shrink-0 w-24 h-24 bg-gray-100 dark:bg-gray-700 rounded-lg relative overflow-hidden">
            ${product.image ? `<img alt="${product.name}" class="w-full h-full object-cover" src="${product.image}">` : '<div class="w-full h-full flex items-center justify-center text-gray-300"><span class="material-symbols-outlined text-3xl">image</span></div>'}
            <div class="absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
                <span class="material-symbols-outlined text-white">edit</span>
            </div>
        </div>
        <div class="flex-1 flex flex-col gap-2 min-w-0">
            <input class="w-full h-9 px-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 border-none focus:ring-1 focus:ring-primary text-sm font-bold text-gray-900 dark:text-white placeholder-gray-400" type="text" value="${product.name}" onchange="updateProductName('${categoryId}', '${product.id}', this.value)">
            <div class="flex items-center gap-2">
                <span class="material-symbols-outlined text-gray-400 text-lg">link</span>
                <input class="w-full h-8 px-2 rounded-lg bg-transparent border-none focus:ring-0 p-0 text-xs text-primary font-medium placeholder-gray-400 truncate" type="text" value="${product.link}" onchange="updateProductLink('${categoryId}', '${product.id}', this.value)">
            </div>
            <div class="flex items-center justify-between mt-auto pt-1">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-5 rounded-full ${product.visible ? 'bg-primary' : 'bg-gray-300'} flex items-center ${product.visible ? 'justify-end' : 'justify-start'} px-1 cursor-pointer" onclick="toggleProductVisibility('${categoryId}', '${product.id}')">
                        <div class="w-3 h-3 bg-white rounded-full"></div>
                    </div>
                    <span class="text-xs font-medium text-gray-500">${product.visible ? 'Hi·ªÉn th·ªã' : '·∫®n'}</span>
                </div>
                <button class="text-red-400 hover:text-red-500 p-1.5 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors" onclick="deleteProduct('${categoryId}', '${product.id}')">
                    <span class="material-symbols-outlined text-xl">delete</span>
                </button>
            </div>
        </div>
    `;
    return card;
}

function showCategoryEditor(categoryId = null) {
    const editor = document.getElementById('categoryEditor');
    const nameInput = document.getElementById('categoryName');
    const descInput = document.getElementById('categoryDesc');
    const deleteBtn = document.getElementById('deleteCategoryBtn');

    editingCategoryId = categoryId;

    if (categoryId) {
        const category = categories.find(c => c.id === categoryId);
        nameInput.value = category.name;
        descInput.value = category.description;
        selectIcon(category.icon);
        deleteBtn.classList.remove('hidden');
    } else {
        nameInput.value = '';
        descInput.value = '';
        selectIcon('child_care');
        deleteBtn.classList.add('hidden');
    }

    editor.classList.remove('hidden');
    nameInput.focus();
}

function hideCategoryEditor() {
    document.getElementById('categoryEditor').classList.add('hidden');
    editingCategoryId = null;
}

function saveCategory() {
    const nameInput = document.getElementById('categoryName');
    const descInput = document.getElementById('categoryDesc');
    const name = nameInput.value.trim();
    const description = descInput.value.trim();

    if (!name) {
        alert('Vui l√≤ng nh·∫≠p t√™n danh m·ª•c!');
        return;
    }

    if (editingCategoryId) {
        // Update existing category
        const category = categories.find(c => c.id === editingCategoryId);
        category.name = name;
        category.description = description;
        category.icon = getSelectedIcon();
    } else {
        // Create new category
        const newCategory = {
            id: 'cat' + Date.now(),
            name: name,
            icon: getSelectedIcon(),
            description: description,
            products: []
        };
        categories.push(newCategory);
    }

    loadCategories();
    hideCategoryEditor();

    // If editing, refresh products if this category is selected
    if (editingCategoryId && selectedCategoryId === editingCategoryId) {
        showCategoryProducts(editingCategoryId);
    }
}

function deleteCategory() {
    if (!editingCategoryId) return;

    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a danh m·ª•c n√†y v√† t·∫•t c·∫£ s·∫£n ph·∫©m trong ƒë√≥?')) {
        categories = categories.filter(c => c.id !== editingCategoryId);
        if (selectedCategoryId === editingCategoryId) {
            selectedCategoryId = null;
            document.getElementById('productsTitle').textContent = 'Ch·ªçn danh m·ª•c ƒë·ªÉ xem s·∫£n ph·∫©m';
            document.getElementById('productsList').innerHTML = '';
        }
        loadCategories();
        hideCategoryEditor();
    }
}

function renderIconSelector() {
    const iconSelector = document.getElementById('iconSelector');
    iconSelector.innerHTML = '';

    availableIcons.forEach(icon => {
        const iconDiv = document.createElement('div');
        iconDiv.className = 'w-12 h-12 rounded-xl bg-gray-50 dark:bg-gray-700 border border-gray-100 dark:border-gray-600 flex items-center justify-center text-gray-400 hover:text-primary hover:border-primary cursor-pointer shrink-0 transition-all icon-option';
        iconDiv.setAttribute('data-icon', icon);
        iconDiv.innerHTML = `<span class="material-symbols-outlined">${icon}</span>`;
        iconDiv.addEventListener('click', () => selectIcon(icon));
        iconSelector.appendChild(iconDiv);
    });
}

function selectIcon(iconName) {
    document.querySelectorAll('.icon-option').forEach(el => {
        el.classList.remove('border-primary', 'text-primary');
        el.innerHTML = `<span class="material-symbols-outlined">${el.getAttribute('data-icon')}</span>`;
    });

    const selectedIcon = document.querySelector(`[data-icon="${iconName}"]`);
    selectedIcon.classList.add('border-primary', 'text-primary');
    selectedIcon.innerHTML = `
        <span class="material-symbols-outlined">${iconName}</span>
        <div class="absolute -top-1 -right-1 w-4 h-4 bg-primary text-white rounded-full flex items-center justify-center shadow-sm">
            <span class="material-symbols-outlined text-[10px] font-bold">check</span>
        </div>
    `;
}

function getSelectedIcon() {
    const selected = document.querySelector('.icon-option.border-primary');
    return selected ? selected.getAttribute('data-icon') : 'child_care';
}

function addNewProduct() {
    if (!selectedCategoryId) {
        alert('Vui l√≤ng ch·ªçn danh m·ª•c tr∆∞·ªõc khi th√™m s·∫£n ph·∫©m!');
        return;
    }

    const category = categories.find(c => c.id === selectedCategoryId);
    const newProduct = {
        id: 'prod' + Date.now(),
        name: '',
        link: '',
        image: '',
        visible: false
    };

    category.products.unshift(newProduct);
    showCategoryProducts(selectedCategoryId);

    // Focus on the new product name input
    setTimeout(() => {
        const firstProductInput = document.querySelector('#productsList input[type="text"]');
        if (firstProductInput) firstProductInput.focus();
    }, 100);
}

function updateProductName(categoryId, productId, newName) {
    const category = categories.find(c => c.id === categoryId);
    const product = category.products.find(p => p.id === productId);
    product.name = newName;
}

function updateProductLink(categoryId, productId, newLink) {
    const category = categories.find(c => c.id === categoryId);
    const product = category.products.find(p => p.id === productId);
    product.link = newLink;
}

function toggleProductVisibility(categoryId, productId) {
    const category = categories.find(c => c.id === categoryId);
    const product = category.products.find(p => p.id === productId);
    product.visible = !product.visible;
    showCategoryProducts(categoryId);
}

function deleteProduct(categoryId, productId) {
    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')) {
        const category = categories.find(c => c.id === categoryId);
        category.products = category.products.filter(p => p.id !== productId);
        showCategoryProducts(categoryId);
    }
}

// Google Drive API variables
let isGoogleApiLoaded = false;

// Image upload variables
let selectedAvatarFile = null;
let selectedBackgroundFile = null;

// Initialize Google API
function initGoogleAPI() {
    return new Promise((resolve, reject) => {
        // Check if gapi is available
        if (typeof gapi === 'undefined') {
            console.error('Google API script not loaded');
            reject(new Error('Google API script not loaded'));
            return;
        }

        gapi.load('client:auth2', async () => {
            try {
                await gapi.client.init({
                    apiKey: 'AIzaSyBk0GLruKL0GiU_ZZcL8p5O6PtswWapEHE',
                    clientId: '1095185262237-0poao0vtu5hvvs4n5on1i4q1p65ipnkl.apps.googleusercontent.com', // You'll need to replace this
                    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                    scope: 'https://www.googleapis.com/auth/drive.file'
                });

                isGoogleApiLoaded = true;
                console.log('Google API initialized successfully');
                resolve();
            } catch (error) {
                console.error('Error initializing Google API:', error);
                reject(error);
            }
        });
    });
}

// Handle avatar image upload
function handleAvatarUpload(event) {
    const file = event.target.files[0];
    if (file) {
        selectedAvatarFile = file;

        // Preview image
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('avatarPreview').src = e.target.result;
        };
        reader.readAsDataURL(file);

        console.log('Avatar selected:', file.name);
    }
}

// Handle background image upload
function handleBackgroundUpload(event) {
    const file = event.target.files[0];
    if (file) {
        selectedBackgroundFile = file;

        // Preview image
        const reader = new FileReader();
        reader.onload = function(e) {
            const previewDiv = document.getElementById('backgroundPreview');
            previewDiv.style.backgroundImage = `url("${e.target.result}")`;
            previewDiv.style.backgroundSize = 'cover';
            previewDiv.style.backgroundPosition = 'center';
            previewDiv.innerHTML = ''; // Remove placeholder content
        };
        reader.readAsDataURL(file);

        console.log('Background selected:', file.name);
    }
}

// Upload file to Google Drive
async function uploadToGoogleDrive(file) {
    if (!isGoogleApiLoaded) {
        throw new Error('Google API not loaded');
    }

    try {
        // Check if user is signed in
        const authInstance = gapi.auth2.getAuthInstance();
        if (!authInstance.isSignedIn.get()) {
            await authInstance.signIn();
        }

        // Create file metadata
        const metadata = {
            name: file.name,
            mimeType: file.type,
            parents: ['root'] // Upload to root directory
        };

        // Create FormData for multipart upload
        const formData = new FormData();
        formData.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
        formData.append('file', file);

        // Upload file
        const response = await gapi.client.drive.files.create({
            resource: metadata,
            media: {
                mimeType: file.type,
                body: file
            }
        });

        const fileId = response.result.id;

        // Make file publicly accessible
        await gapi.client.drive.permissions.create({
            fileId: fileId,
            resource: {
                role: 'reader',
                type: 'anyone'
            }
        });

        // Get public URL
        const publicUrl = `https://drive.google.com/uc?id=${fileId}`;

        console.log('File uploaded successfully:', publicUrl);
        return publicUrl;

    } catch (error) {
        console.error('Error uploading to Google Drive:', error);
        throw error;
    }
}

// Save all data to backend API
async function saveToFirebase() {
    try {
        // Collect profile data
        const profileName = document.querySelector('input[type="text"][value*="M·∫π B·ªâm S·ªØa Review"]').value;
        const profileBio = document.querySelector('textarea').value;

        let profileAvatar = 'https://lh3.googleusercontent.com/aida-public/AB6AXuD4-4nseipxqo0kUCZE9uFM44MdTSYdXZK7Ip6KdlyymxoMUAFfS7Ve06-Q9hHGxjPluC6X1APdZdN4rucbf81eaxjkm_YhmgvFAXw4pcASA-ix8llEXZC5nUN6SacEV2XF_k-dtb9Yva94yHVEtkau6hvENT-rlCm-EdLda-wSIKp47tOJkZDAYu-1VrHNM-2ra5qRFgsaqhl86noxOuc2f75yKQwk7z-_QUC1XkJ0rEhR3XHAN6BLxLkkhAlcI2nDPjqbfeDSZ3h2';
        let backgroundImage = 'https://lh3.googleusercontent.com/aida-public/AB6AXuC8aAcLjxpyVZyPCmL72kiLClze8F-26nZRzXjNA-qmY4h-RzSJhNeTrZLXfhEr5bEkoErKSv2uzqv6I_Z1c0WGToWBBo8lmLUNeAu_LDe-B6S3W7w34pYYpdPQrqxAz8xq3TpZqdZYGIbp69Ua_oGY5QBQh5-87_vbnvnV7ZBjOqxAz-WTUZIAhSwh7ZlLA7pHlcbVbQ-UyX1jMuk4iQ_-RC6DX9nJz-Q_qINfaQcsZmJBDXDCP-yJdKV9S66Jyooe_Tw2Che6pEPO';

        // Upload images to backend if selected
        try {
            if (selectedAvatarFile) {
                console.log('Uploading avatar...');
                const formData = new FormData();
                formData.append('avatar', selectedAvatarFile);

                const response = await fetch('/api/upload/avatar', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    profileAvatar = result.publicUrl;
                    console.log('Avatar uploaded:', profileAvatar);
                } else {
                    throw new Error('Avatar upload failed');
                }
            }

            if (selectedBackgroundFile) {
                console.log('Uploading background...');
                const formData = new FormData();
                formData.append('background', selectedBackgroundFile);

                const response = await fetch('/api/upload/background', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    backgroundImage = result.publicUrl;
                    console.log('Background uploaded:', backgroundImage);
                } else {
                    throw new Error('Background upload failed');
                }
            }
        } catch (uploadError) {
            console.error('Image upload failed:', uploadError);
            alert('Upload h√¨nh ·∫£nh th·∫•t b·∫°i. S·∫Ω s·ª≠ d·ª•ng h√¨nh m·∫∑c ƒë·ªãnh.');
        }

        // Prepare data structure
        const siteData = {
            profile: {
                name: profileName,
                bio: profileBio,
                avatar: profileAvatar
            },
            backgroundImage: backgroundImage,
            categories: categories.map(cat => ({
                id: cat.id,
                name: cat.name,
                icon: cat.icon,
                description: cat.description,
                products: cat.products.filter(prod => prod.visible).map(prod => ({
                    id: prod.id,
                    name: prod.name,
                    link: prod.link,
                    image: prod.image,
                    visible: prod.visible
                }))
            })),
            lastUpdated: new Date().toISOString()
        };

        // Save to backend API
        const response = await fetch('/api/site-data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(siteData)
        });

        if (response.ok) {
            console.log("Data saved successfully:", siteData);
            alert('ƒê√£ xu·∫•t b·∫£n th√†nh c√¥ng! Trang web s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t.');

            // Reset file selections
            selectedAvatarFile = null;
            selectedBackgroundFile = null;
        } else {
            throw new Error('Save failed');
        }

    } catch (error) {
        console.error("Error saving data:", error);
        alert('C√≥ l·ªói x·∫£y ra khi l∆∞u d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.');
    }
}

// TODO: Implement Google Drive upload function
// async function uploadToGoogleDrive(file) {
//     // Implement Google Drive API upload here
//     // Return the public URL of the uploaded file
//     return 'https://drive.google.com/uc?id=uploaded_file_id';
// }
</script>
</body></html>
